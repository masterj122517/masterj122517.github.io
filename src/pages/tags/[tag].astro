---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import MasonryGrid from '../../components/MasonryGrid.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  const allTags = posts.flatMap((post: any) => post.data.tags);
  const uniqueTags = [...new Set(allTags)];
  
  return uniqueTags.map((tag) => ({
    params: { tag },
    props: { 
      tag,
      posts: posts.filter((post: any) => post.data.tags.includes(tag)),
    },
  }));
}

const { tag, posts } = Astro.props;
---

<BaseLayout title={`Posts tagged with "${tag}"`}>
  <div class="pt-24 pb-12">
    <Header />
    
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-16">
      <h1 class="text-4xl md:text-5xl font-bold text-text mb-4">
        #{tag}
      </h1>
      <p class="text-lg text-text-muted mb-12">
        Posts tagged with "{tag}"
      </p>
      
      {posts.length > 0 ? (
        <MasonryGrid posts={posts} />
      ) : (
        <p class="text-text-muted">No posts found with this tag.</p>
      )}
    </div>
    
    <Footer />
  </div>
</BaseLayout>
